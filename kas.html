<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Menu Kas</title>
<style>
  table, th, td { border:1px solid #ccc; border-collapse:collapse; padding:5px; }
  img { max-width:100px; cursor:pointer; }
</style>
</head>
<body>

<h2>Menu Kas</h2>

<label>Kode:</label>
<input type="text" id="kode"><br><br>

<label>Bulan:</label>
<select id="bulan">
  <option value="1">Januari</option>
  <option value="2">Februari</option>
  <option value="3">Maret</option>
  <option value="4">April</option>
  <option value="5">Mei</option>
  <option value="6">Juni</option>
  <option value="7">Juli</option>
  <option value="8">Agustus</option>
  <option value="9">September</option>
  <option value="10">Oktober</option>
  <option value="11">November</option>
  <option value="12">Desember</option>
</select>
<button onclick="tampilKas()">Tampilkan</button>

<table id="tabel">
<thead>
<tr>
  <th>No</th>
  <th>Timestamp</th>
  <th>Tanggal</th>
  <th>Nama</th>
  <th>Jenis</th>
  <th>Jumlah Masuk</th>
  <th>Jumlah Keluar</th>
  <th>Keterangan</th>
  <th>Foto Bukti</th>
</tr>
</thead>
<tbody></tbody>
</table>

<p>Total Masuk: <span id="totalMasuk">0</span></p>
<p>Total Keluar: <span id="totalKeluar">0</span></p>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxOke50DE-_UqLcGawoG6Vxd6suNHg0axjC06iMpdx9hSuKZQ5BuXrut_ckzxsLak-1Ww/exec"; // ganti dengan URL Web App

// Fungsi format rupiah
function formatRupiah(angka){
  return "Rp " + Number(angka).toLocaleString('id-ID');
}

function tampilKas(){
  var kode = document.getElementById("kode").value;
  var bulan = document.getElementById("bulan").value;

  fetch(`${API_URL}?kode=${kode}&bulan=${bulan}`)
    .then(res => res.json())
    .then(res => {
      if(res.msg){
        alert(res.msg);
        return;
      }

      var tbody = document.querySelector("#tabel tbody");
      tbody.innerHTML = "";

      res.data.forEach((row,i)=>{
        var tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${row[0]}</td>  <!-- Timestamp -->
          <td>${row[1]}</td>  <!-- Tanggal -->
          <td>${row[2]}</td>  <!-- Nama -->
          <td>${row[3]}</td>  <!-- Jenis -->
          <td>${formatRupiah(row[4])}</td>
          <td>${formatRupiah(row[5])}</td>
          <td>${row[6]}</td>
          <td>${row[7]?`<img src="${row[7]}" onclick="window.open('${row[7]}')" />`:"-"}</td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById("totalMasuk").textContent = formatRupiah(res.totalMasuk);
      document.getElementById("totalKeluar").textContent = formatRupiah(res.totalKeluar);
    })
    .catch(err => alert("Gagal ambil data: "+err));
}
</script>

</body>
</html>
