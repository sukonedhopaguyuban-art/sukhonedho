<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kas Sukho Nedho</title>
<style>
body { font-family: Arial; padding:20px }
input, button { padding:6px; margin:4px }
table { border-collapse: collapse; width:100% }
td, th { border:1px solid #ccc; padding:6px }
</style>
</head>
<body>

<h2>Login Kas</h2>

<div id="login">
  <input id="email" placeholder="Email"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
  <p id="msg" style="color:red"></p>
</div>

<div id="kas" style="display:none">
  <h3>Input Kas</h3>
  <input type="date" id="tanggal"><br>
  <input placeholder="Nama Transaksi" id="nama"><br>
  <select id="jenis">
    <option>Masuk</option>
    <option>Keluar</option>
  </select><br>
  <input type="number" id="jumlah"><br>
  <input placeholder="Keterangan" id="ket"><br>
  <input type="file" id="foto"><br>
  <button onclick="simpan()">Simpan</button>

  <h3>Data Kas</h3>
  <table id="tabel"></table>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbw3kTSQjD-RQd9v1P13m_SaAJ5fMdEZ_-WOGxrgh04WzrewmhRU1KhHYdqpc9bTnqgj/exec";

function login() {
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "login",
      email: email.value,
      password: password.value
    })
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.status==="ok"){
      login.style.display="none";
      kas.style.display="block";
      loadKas();
    } else {
      msg.innerText="LOGIN GAGAL";
    }
  });
}

function simpan() {
  const f = foto.files[0];
  const r = new FileReader();

  r.onload = () => {
    fetch(API, {
      method:"POST",
      body:JSON.stringify({
        action:"addKas",
        tanggal:tanggal.value,
        nama:nama.value,
        jenis:jenis.value,
        jumlah:jumlah.value,
        keterangan:ket.value,
        foto:r.result.split(",")[1],
        fotoType:f.type
      })
    }).then(()=>loadKas());
  };

  if(f) r.readAsDataURL(f);
}

function loadKas() {
  fetch(API,{
    method:"POST",
    body:JSON.stringify({action:"getKas"})
  })
  .then(r=>r.json())
  .then(d=>{
    tabel.innerHTML="<tr><th>Tgl</th><th>Nama</th><th>Jenis</th><th>Jumlah</th><th>Ket</th><th>Foto</th></tr>";
    d.forEach(r=>{
      tabel.innerHTML+=`<tr>
        <td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td>
        <td>${r[3]}</td><td>${r[4]}</td>
        <td>${r[5]?`<a href="${r[5]}" target="_blank">Foto</a>`:""}</td>
      </tr>`;
    });
  });
}
</script>

</body>
</html>
